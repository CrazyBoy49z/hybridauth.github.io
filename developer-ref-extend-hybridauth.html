<!DOCTYPE html>
<html lang="en">
	<title>Extend hybridauth - Hybridauth</title>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="description" content="">
	<meta name="keywords" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link href="http://fonts.googleapis.com/css?family=Roboto:100,200,300,400,700|Roboto+Condensed:400,700" rel="stylesheet" type="text/css">

	<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet"> 
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="assets/css/prettify.css" rel="stylesheet"> 
	<link href="assets/css/style.css" rel="stylesheet">   

	<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script> 
	<script type="text/javascript" src="assets/js/prettify.js"></script>
	<script type="text/javascript" src="assets/js/script.js"></script>
</head>
<body id="documentation">
	<header>
		<nav class="navbar navbar-fixed-top">
			<div class="navbar-header">
				<a class="navbar-brand" href="./index.html">Hybridauth</a>
			</div>

			<div class="collapse navbar-collapse">
				<ul class="nav navbar-nav navbar-right"> 
					<li><a href="https://github.com/hybridauth/hybridauth/releases" target="_blank">Download</a></li> 
					<li><a href="./documentation.html">Documentation</a></li>
					<li><a href="./getinvolved.html">Get involved</a></li> 
					<li style="margin-right:10px">
						<form action="./search.html" method="get">
							<input type="text" name="q" class="search-input" placeholder="Search">
						</form>
					</li>
				</ul>
			</div>
		</nav>
	</header>

 
	<div id="content" class="container container-documentation">
		<div class="block row">
			<div class="col col-md-12">

<!-- ... -->

<h1>Upgrading supported providers to 3.0</h1>

<h2>1. OpenID</h2>

<p>OpenID providers are still the same and they are the most easy ones: in most cases we just set $openidIdentifier and that's it.</p>

<pre class="prettyprint linenums">namespace Hybridauth\Provider;

use Hybridauth\Adapter\OpenID;

final class Stackoverflow extends OpenID
{
    protected $openidIdentifier = 'https://openid.stackexchange.com/';
}
</pre>

<h2>2. OAuth 2</h2>

<p>OAuth2Client and Model_OAuth2 are now merged together into a new abstract class to simplify the authorization flow.</p>

<p>Subclasses (i.e., providers adapters) can either use the already provided methods by the new OAuth2 class, override them, or create new ones when needed.</p>

<pre class="prettyprint linenums">namespace Hybridauth\Provider;

use Hybridauth\Adapter\OAuth2;
use Hybridauth\Exception;
use Hybridauth\Exception\UnexpectedValueException;
use Hybridauth\Data;
use Hybridauth\User;

final class MyCustomProvider extends OAuth2
{
    /**
    * Defaults scope to requests 
    */
    protected $scope = 'email, ...';

    /**
    * Default Base URL to provider API
    */
    protected $apiBaseUrl = 'https://api.provider.ltd/version/';

    /**
    * Default Authorization Endpoint
    */
    protected $authorizeUrl = 'https://api.provider.ltd/oauth/authorize';

    /**
    * Default Access Token Endpoint
    */
    protected $accessTokenUrl = 'https://api.provider.ltd/oauth/access_token';

    /* optional: set any extra parameters or settings */
    protected function initialize()
    {
        parent::initialize();

        /* optional: determine how exchange Authorization Code with an Access Token */
        $this-&gt;tokenExchangeParameters = [
            'client_id'     =&gt; $this-&gt;clientId,
            'grant_type'    =&gt; 'authorization_code',
            'redirect_uri'  =&gt; $this-&gt;endpoint
        ];
        $this-&gt;tokenExchangeMethod  = 'POST';
        $this-&gt;tokenExchangeHeaders = [ 'Authorization' =&gt; 'Basic ' . base64_encode( $this-&gt;clientId .  ':' . $this-&gt;clientSecret ) ];

        /* optional: add any extra parameters or headers when sending signed requests */
        $this-&gt;apiRequestParameters = [ 'access_token'  =&gt; $this-&gt;token( 'access_token' ) ];
        $this-&gt;apiRequestHeaders    = [ 'Authorization' =&gt; 'Bearer ' . $this-&gt;token( 'access_token' ) ];
    } 

    function getUserProfile()
    {
        /* now we use apiRequest() for signed requests. */
        $response = $this-&gt;apiRequest( 'user/profile', 'GET', [], [ 'Authorization' =&gt; .. ] );

        /* example of how to instantiate a user profile and how to use data collection, assuming user/profile returns this response:

            {
                "id": "98131543",
                "firstName": "John",
                "lastName": "Smith",
                "age": 25,
                "emails : "John.Smith@domain.ltd",
                "address": {
                    "streetAddress": "21 2nd Street",
                    "city": "New York",
                    "state": "NY",
                    "postalCode": "10021-3100"
                }
            }
        */

        $collection = new Data\Collection( $response );

        $userProfile = new User\Profile();

        if( ! $data-&gt;exists( 'id' ) )
        {
            throw new UnexpectedValueException( 'Provider API returned an unexpected response.' );
        }

        $userProfile-&gt;identifier = $collection-&gt;get( 'id' );

        $userProfile-&gt;email = $collection-&gt;get( 'email' );

        $userProfile-&gt;displayName = $data-&gt;get( 'firstName' ) . ' ' . $data-&gt;get( 'lastName' ) ;

        if( $collection-&gt;exists( 'image' ) )
        {
            $userProfile-&gt;photoURL = 'http://provider.ltd/users/' . $collection-&gt;get( 'image' );
        }

        $userProfile-&gt;address = $collection-&gt;filter( 'address' )-&gt;get( 'streetAddress' );

        $userProfile-&gt;city = $collection-&gt;filter( 'address' )-&gt;get( 'city' );

        // ...

        return $userProfile;
    }

    //..
}
</pre>

<h2>3. OAuth 1</h2>

<p>OAuth 1 is very similar to OAuth 2. Subclasses can set the default provider endpoints and settings.</p>

<pre class="prettyprint linenums">namespace Hybridauth\Provider;

use Hybridauth\Adapter\OAuth1;
use Hybridauth\Exception\UnexpectedValueException;
use Hybridauth\Data;
use Hybridauth\User;

final class MyCustomProvider extends OAuth1
{
    /**
    * Default Base URL to provider API
    */
    protected $apiBaseUrl = 'https://api.provider.ltd/version/';

    /**
    * Default Authorization Endpoint
    */
    protected $authorizeUrl = 'https://api.provider.ltd/oauth/authorize';

    /**
    * Unauthorized Request Token Endpoint
    */
    protected $requestTokenUrl = 'https://api.provider.ltd/oauth/request_token';

    /**
    * Default Access Token Endpoint
    */
    protected $accessTokenUrl = 'https://api.provider.ltd/oauth/access_token';

    /* optional: set any extra parameters or settings */
    protected function initialize()
    {
        parent::initialize();

        /* optional: define a how request Unauthorized OAuth Token */
        $this-&gt;requestTokenMethod     = 'GET'; 
        $this-&gt;requestTokenParameters = [ .. ];
        $this-&gt;requestTokenHeaders    = [ .. ]; 

        /* optional: determine how the exchange Unauthorized OAuth Token with an Access Token */
        $this-&gt;tokenExchangeMethod     = 'POST'; 
        $this-&gt;tokenExchangeParameters = [ .. ]; 
        $this-&gt;tokenExchangeHeaders    = [ .. ];

        /* optional: add any extra parameters or headers when sending signed requests */
        $this-&gt;apiRequestParameters = [ 'access_token'    =&gt; $this-&gt;token( 'access_token' ) ];
        $this-&gt;apiRequestHeaders    = [ 'Accept-Encoding' =&gt; 'compress, gzip' ];
    }

    //..
}
</pre>


<!-- ... -->

                <hr />
                <br />
                <a name="comments"></a>
                <div style="padding: 8px;background-color:#FAFAFA;border: 1px solid #ccc;padding: 10px;text-align:center;box-shadow: 0 1px 3px rgba(0,0,0,0.13);">
                    <h4 style="border: 0px none; margin: 12px;">Please, do not submit issues here.</h4>

                    <p>This comment section is for a general questions and feedback. If you want to report a bug, please refer to the <a href="support.html">Support</a> section.</p>
                </div> 
                <br />
                <div id="disqus_thread"></div>
                <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'hybridauth'; // required: replace example with your forum shortname
                    var disqus_identifier = 'developer-ref-extend-hybridauth.html';
                    var disqus_url = 'http://hybridauth.github.io/hybridauth/developer-ref-extend-hybridauth.html';
                    
                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>

                <br />
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="row"> 
                <ul>
                    <li><a href="./index.html">Home</a></li>
					<li><a href="https://github.com/hybridauth/hybridauth/releases" target="_blank">Download</a></li> 
					<li><a href="./documentation.html">Documentation</a></li>
					<li><a href="./getinvolved.html">Get involved</a></li> 
                    <li><a href="./license.html">License</a></li> 
                    &mdash;
					<li><a href="https://github.com/hybridauth/hybridauth" target="_blank">Github</a></li> 
					<li><a href="https://gitter.im/hybridauth/hybridauth" target="_blank">Gitter</a></li> 
                </ul>
            </div>
        </div>
    </footer>
</body>
</html>

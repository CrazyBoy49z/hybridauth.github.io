<!DOCTYPE html>
<html lang="en">
    <title>
        Extending Hybridauth - Adding new providers
    </title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="description" content="Describes how to add new providers adapters to Hybridauth, and how to port them from 2.x.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans:100,200,300,400,500,600,700" rel="stylesheet" type="text/css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"> 
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="/assets/css/tranquil-heart.css" rel="stylesheet"> 
    <link href="/assets/css/style.css" rel="stylesheet">   

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script> 
    <script type="text/javascript" src="/assets/js/prettify.js"></script>
    <script type="text/javascript" src="/assets/js/script.js"></script>
</head>
<body id="documentation">
    <header>
        <nav class="navbar navbar-fixed-top">
            <div class="navbar-header">
                <a class="navbar-brand" href="/index.html">Hybridauth 3</a>
            </div>

            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav navbar-right"> 
                    <li><a href="https://github.com/hybridauth/hybridauth/releases" target="_blank">Download</a></li> 
                    <li><a href="/documentation.html">Documentation</a></li>
                    <li><a href="/getinvolved.html">Get involved</a></li> 
                    <li><a href="/support.html">Support</a></li> 
                    <li style="margin-right:10px">
                        <form action="/search.html" method="get">
                            <input type="text" name="q" class="search-input" placeholder="Search">
                        </form>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <div id="content" class="container container-documentation">
        <div class="block row">
            <div class="col col-md-12">

<!-- ... -->

<h1 id="upgrading-supported-providers-to-30">Upgrading supported providers to 3.0</h1>

<h2 id="1-openid">1. OpenID</h2>

<p>OpenID providers are still the same and they are the most easy ones: in most cases we just set $openidIdentifier and thatâ€™s it.</p>

<pre>
namespace Hybridauth\Provider;

use Hybridauth\Adapter\OpenID;

final class StackoverflowOpenID extends OpenID
{
    protected $openidIdentifier = 'https://openid.stackexchange.com/';
}
</pre>

<h2 id="2-oauth-2">2. OAuth 2</h2>

<p><code class="highlighter-rouge">OAuth2Client</code> and <code class="highlighter-rouge">Model_OAuth2</code> are now merged together into a new abstract class to simplify the authorization flow.</p>

<p>Subclasses (i.e., providers adapters) can either use the already provided methods by the new OAuth2 class, override them,
or create new ones when needed.</p>

<pre>
namespace Hybridauth\Provider;

use Hybridauth\Adapter\OAuth2;
use Hybridauth\Exception;
use Hybridauth\Exception\UnexpectedValueException;
use Hybridauth\Data;
use Hybridauth\User;

final class MyCustomProvider extends OAuth2
{
    /**
    * Defaults scope to requests 
    */
    protected $scope = 'email, ...';

    /**
    * Default Base URL to provider API
    */
    protected $apiBaseUrl = 'https://api.provider.ltd/version/';

    /**
    * Default Authorization Endpoint
    */
    protected $authorizeUrl = 'https://api.provider.ltd/oauth/authorize';

    /**
    * Default Access Token Endpoint
    */
    protected $accessTokenUrl = 'https://api.provider.ltd/oauth/access_token';

    /* optional: set any extra parameters or settings */
    protected function initialize()
    {
        parent::initialize();

        /* optional: determine how exchange Authorization Code with an Access Token */
        $this-&gt;tokenExchangeParameters = [
            'client_id'     =&gt; $this-&gt;clientId,
            'grant_type'    =&gt; 'authorization_code',
            'redirect_uri'  =&gt; $this-&gt;endpoint
        ];
        $this-&gt;tokenExchangeMethod  = 'POST';
        $this-&gt;tokenExchangeHeaders = [ 'Authorization' =&gt; 'Basic ' . base64_encode( $this-&gt;clientId .  ':' . $this-&gt;clientSecret ) ];

        /* optional: add any extra parameters or headers when sending signed requests */
        $this-&gt;apiRequestParameters = [ 'access_token'  =&gt; $this-&gt;token( 'access_token' ) ];
        $this-&gt;apiRequestHeaders    = [ 'Authorization' =&gt; 'Bearer ' . $this-&gt;token( 'access_token' ) ];
    } 

    function getUserProfile()
    {
        /* Send a signed http request to provider API to request user's profile */
        $response = $this-&gt;apiRequest( 'user/profile' );

        /* Example of how to instantiate a user profile and how to use data collection
           assuming user/profile returns this response:
            {
                "id": "98131543",
                "firstName": "John",
                "lastName": "Smith",
                "age": 25,
                "emails : "John.Smith@domain.ltd",
                "address": {
                    "streetAddress": "21 2nd Street",
                    "city": "New York",
                    "state": "NY",
                    "postalCode": "10021-3100"
                }
            }
        */

        $collection = new Data\Collection( $response );

        $userProfile = new User\Profile();

        if( ! $data-&gt;exists( 'id' ) )
        {
            throw new UnexpectedValueException( 'Provider API returned an unexpected response.' );
        }

        $userProfile-&gt;identifier = $collection-&gt;get( 'id' );
        $userProfile-&gt;email = $collection-&gt;get( 'email' );
        $userProfile-&gt;displayName = $data-&gt;get( 'firstName' ) . ' ' . $data-&gt;get( 'lastName' ) ;
        $userProfile-&gt;address = $collection-&gt;filter( 'address' )-&gt;get( 'streetAddress' );
        $userProfile-&gt;city = $collection-&gt;filter( 'address' )-&gt;get( 'city' );

        if( $collection-&gt;exists( 'image' ) )
        {
            $userProfile-&gt;photoURL = 'http://provider.ltd/users/' . $collection-&gt;get( 'image' );
        }

        return $userProfile;
    }

    //..
}
</pre>

<h2 id="3-oauth-1">3. OAuth 1</h2>

<p>OAuth 1 is very similar to OAuth 2. Subclasses can set the default provider endpoints and settings.</p>

<pre>
namespace Hybridauth\Provider;

use Hybridauth\Adapter\OAuth1;
use Hybridauth\Exception\UnexpectedValueException;
use Hybridauth\Data;
use Hybridauth\User;

final class MyCustomProvider extends OAuth1
{
    /**
    * Default Base URL to provider API
    */
    protected $apiBaseUrl = 'https://api.provider.ltd/version/';

    /**
    * Default Authorization Endpoint
    */
    protected $authorizeUrl = 'https://api.provider.ltd/oauth/authorize';

    /**
    * Unauthorized Request Token Endpoint
    */
    protected $requestTokenUrl = 'https://api.provider.ltd/oauth/request_token';

    /**
    * Default Access Token Endpoint
    */
    protected $accessTokenUrl = 'https://api.provider.ltd/oauth/access_token';

    /* optional: set any extra parameters or settings */
    protected function initialize()
    {
        parent::initialize();

        /* optional: define a how request Unauthorized OAuth Token */
        $this-&gt;requestTokenMethod     = 'GET'; 
        $this-&gt;requestTokenParameters = [ .. ];
        $this-&gt;requestTokenHeaders    = [ .. ]; 

        /* optional: determine how the exchange Unauthorized OAuth Token with an Access Token */
        $this-&gt;tokenExchangeMethod     = 'POST'; 
        $this-&gt;tokenExchangeParameters = [ .. ]; 
        $this-&gt;tokenExchangeHeaders    = [ .. ];

        /* optional: add any extra parameters or headers when sending signed requests */
        $this-&gt;apiRequestParameters = [ 'access_token'    =&gt; $this-&gt;token( 'access_token' ) ];
        $this-&gt;apiRequestHeaders    = [ 'Accept-Encoding' =&gt; 'compress, gzip' ];
    }

    //..
}
</pre>


                <br />
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="row"> 
                <ul>
                    <li><a href="//index.html">Home</a></li>
                    <li><a href="https://github.com/hybridauth/hybridauth/releases" target="_blank">Download</a></li> 
                    <li><a href="/documentation.html">Documentation</a></li>
                    <li><a href="/getinvolved.html">Get involved</a></li> 
                    <li><a href="/support.html">Support</a></li> 
                    <li><a href="/license.html">License</a></li> 
                    <span style="color:white">&mdash;</span>
                    <li><a href="https://github.com/hybridauth/hybridauth" target="_blank">Github</a></li> 
                    <li><a href="https://gitter.im/hybridauth/hybridauth" target="_blank">Gitter</a></li> 
                </ul>
            </div>
        </div>
    </footer>
</body>
</html>

